{"version":3,"sources":["../../src/core/Formatter.ts"],"names":["Formatter","cfg","params","Params","Error","query","tokens","tokenizer","tokenize","ast","Parser","parse","formattedQuery","formatAst","finalQuery","postFormat","trimEnd","statements","asTokenFactory","AsTokenFactory","keywordCase","map","stat","StatementFormatter","format","join","repeat","linesBetweenQueries","tabulateAlias","commaPosition"],"mappings":";;;;;;;AACA;;AAEA;;AACA;;AACA;;AACA;;AACA;;AAEA;;;;;;;;;;;;AAEA;IACqBA,S;AAInB,qBAAYC,GAAZ,EAAgC;AAAA;;AAAA;;AAAA;;AAC9B,SAAKA,GAAL,GAAWA,GAAX;AACA,SAAKC,MAAL,GAAc,IAAIC,kBAAJ,CAAW,KAAKF,GAAL,CAASC,MAApB,CAAd;AACD;AAED;AACF;AACA;;;;;WACE,qBAAiC;AAC/B,YAAM,IAAIE,KAAJ,CAAU,yCAAV,CAAN;AACD;AAED;AACF;AACA;AACA;AACA;;;;WACE,gBAAcC,KAAd,EAAqC;AACnC,UAAMC,MAAM,GAAG,KAAKC,SAAL,GAAiBC,QAAjB,CAA0BH,KAA1B,CAAf;AACA,UAAMI,GAAG,GAAG,IAAIC,kBAAJ,CAAWJ,MAAX,EAAmBK,KAAnB,EAAZ;AACA,UAAMC,cAAc,GAAG,KAAKC,SAAL,CAAeJ,GAAf,EAAoBH,MAApB,CAAvB;AACA,UAAMQ,UAAU,GAAG,KAAKC,UAAL,CAAgBH,cAAhB,CAAnB;AAEA,aAAOE,UAAU,CAACE,OAAX,EAAP;AACD;;;WAED,mBAAkBC,UAAlB,EAA2CX,MAA3C,EAAoE;AAAA;;AAClE,UAAMY,cAAc,GAAG,IAAIC,0BAAJ,CAAmB,KAAKlB,GAAL,CAASmB,WAA5B,EAAyCd,MAAzC,CAAvB;AAEA,aAAOW,UAAU,CACdI,GADI,CACA,UAAAC,IAAI;AAAA,eAAI,IAAIC,8BAAJ,CAAuB,KAAI,CAACtB,GAA5B,EAAiC,KAAI,CAACC,MAAtC,EAA8CgB,cAA9C,EAA8DM,MAA9D,CAAqEF,IAArE,CAAJ;AAAA,OADJ,EAEJG,IAFI,CAEC,KAAKC,MAAL,CAAY,KAAKzB,GAAL,CAAS0B,mBAAT,GAA+B,CAA3C,CAFD,CAAP;AAGD;;;WAED,oBAAmBtB,KAAnB,EAA0C;AACxC,UAAI,KAAKJ,GAAL,CAAS2B,aAAb,EAA4B;AAC1BvB,QAAAA,KAAK,GAAG,sCAAqBA,KAArB,CAAR;AACD;;AACD,UAAI,KAAKJ,GAAL,CAAS4B,aAAT,KAA2B,QAA3B,IAAuC,KAAK5B,GAAL,CAAS4B,aAAT,KAA2B,SAAtE,EAAiF;AAC/ExB,QAAAA,KAAK,GAAG,sCAAqBA,KAArB,EAA4B,KAAKJ,GAAL,CAAS4B,aAArC,EAAoD,0BAAa,KAAK5B,GAAlB,CAApD,CAAR;AACD;;AAED,aAAOI,KAAP;AACD","sourcesContent":["import type { FormatOptions } from 'src/types';\nimport Params from './Params';\nimport Tokenizer from './Tokenizer';\nimport formatCommaPositions from './formatCommaPositions';\nimport formatAliasPositions from './formatAliasPositions';\nimport AsTokenFactory from './AsTokenFactory';\nimport Parser, { type Statement } from './Parser';\nimport StatementFormatter from './StatementFormatter';\nimport { type Token } from './token';\nimport { indentString } from './config';\n\n/** Main formatter class that produces a final output string from list of tokens */\nexport default class Formatter {\n  private cfg: FormatOptions;\n  private params: Params;\n\n  constructor(cfg: FormatOptions) {\n    this.cfg = cfg;\n    this.params = new Params(this.cfg.params);\n  }\n\n  /**\n   * SQL Tokenizer for this formatter, provided by subclasses.\n   */\n  protected tokenizer(): Tokenizer {\n    throw new Error('tokenizer() not implemented by subclass');\n  }\n\n  /**\n   * Formats an SQL query.\n   * @param {string} query - The SQL query string to be formatted\n   * @return {string} The formatter query\n   */\n  public format(query: string): string {\n    const tokens = this.tokenizer().tokenize(query);\n    const ast = new Parser(tokens).parse();\n    const formattedQuery = this.formatAst(ast, tokens);\n    const finalQuery = this.postFormat(formattedQuery);\n\n    return finalQuery.trimEnd();\n  }\n\n  private formatAst(statements: Statement[], tokens: Token[]): string {\n    const asTokenFactory = new AsTokenFactory(this.cfg.keywordCase, tokens);\n\n    return statements\n      .map(stat => new StatementFormatter(this.cfg, this.params, asTokenFactory).format(stat))\n      .join('\\n'.repeat(this.cfg.linesBetweenQueries + 1));\n  }\n\n  private postFormat(query: string): string {\n    if (this.cfg.tabulateAlias) {\n      query = formatAliasPositions(query);\n    }\n    if (this.cfg.commaPosition === 'before' || this.cfg.commaPosition === 'tabular') {\n      query = formatCommaPositions(query, this.cfg.commaPosition, indentString(this.cfg));\n    }\n\n    return query;\n  }\n}\n"],"file":"Formatter.js"}